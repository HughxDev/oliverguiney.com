<script>
  window.OG = window.OG || {};

  OG.String = {
    dasherize: function ogDasherize( string ) {
      return string.toLowerCase().replace( /\s/g, '-' );
    }
  };

  OG.DOM = {
    /**
     * Get the closest matching element up the DOM tree.
     * @private
     * @param  {Element} elem     Starting element
     * @param  {String}  selector Selector to match against
     * @return {Boolean|Element}  Returns null if not match found
    */
    getClosest: function ogGetClosest( elem, selector ) {
    // Element.matches() polyfill
    if ( !Element.prototype.matches ) {
      Element.prototype.matches =
        Element.prototype.matchesSelector ||
        Element.prototype.mozMatchesSelector ||
        Element.prototype.msMatchesSelector ||
        Element.prototype.oMatchesSelector ||
        Element.prototype.webkitMatchesSelector ||
        function( s ) {
          var matches = ( this.document || this.ownerDocument ).querySelectorAll( s ),
          
          i = matches.length;
          
          while ( --i >= 0 && matches.item( i ) !== this ) {}

          return i > -1;
        }
      ;
    }

    // Get closest match
    for ( ; elem && elem !== document && elem.nodeName !== '#document-fragment'; elem = Polymer.dom(elem).parentNode ) {
      if ( elem.matches( selector ) ) {
        return elem;
      }
    }

    return null;
    }
  };

  OG.Image = {
    getSrcset: function ogGetSrcset( container ) {
      var image = this;
      var srcset = '';
      var i;
      var directory;
      var subdirectory = '';
      var filenameAppend = '';
      var referenceObject;

      if ( container ) {
        referenceObject = container;
        groupFilenameId = container.filenameId;
      } else {
        referenceObject = image;
        groupFilenameId = image.filenameId;
      }

      if ( 'subdirectory' in image ) {
        subdirectory = image.subdirectory;

        if ( 'filenameId' in image ) {
          filenameAppend = '%20-%20' + image.filenameId.replace( /\s/g, '%20' );
        }
      }

      if ( referenceObject.resolutions ) {
        i = referenceObject.resolutions.length - 1;

        for ( ; i >= 0; i--) {
          srcset += referenceObject.directory // "/" included
            + groupFilenameId
            + '/'
            + subdirectory
            + '“' // '%E2%80%9C' // “
            + referenceObject.titleOfWork.replace( /\s/g, '%20' )
            + '”' // '%E2%80%9D' // ”
            + '%20'
            + referenceObject.filenameSuffix.replace( /\s/g, '%20' )
            + filenameAppend
            + referenceObject.resolutions[i].zoomLevel.replace( ',', '%2C' )
            + '.'
            + referenceObject.resolutions[i].types[0]
            + ' '
            + referenceObject.resolutions[i].width
            + 'w'
          ;
        
          if ( i !== 0 ) {
            srcset += ', ';
          }
        }
      }

      return srcset;
    }
  };
</script>